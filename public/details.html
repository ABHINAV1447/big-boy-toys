<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Sport | Big Boy Toys</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Outfit:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="style.css?v=5">
    <!-- Load Car Data FIRST -->
    <script src="cars.js"></script>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <a href="index.html">
                <span class="logo-text">BBT</span>
                <span class="logo-sub">Premium</span>
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#collection">Collection</a></li>
            <li><a href="index.html#services">Services</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <a href="signin.html" class="btn-primary">Sign In</a>
        <div class="mobile-toggle">
            <i data-lucide="menu"></i>
        </div>
    </nav>

    <!-- Product Hero (Dynamic) -->
    <section class="product-hero">
        <div class="product-gallery">
            <div class="main-image-container">
                <img id="main-img" src="" alt="Car Image" class="active-img">
            </div>
            <div class="thumbnail-row">
                <img id="thumb-1" src="" alt="View 1" class="thumb active" onclick="changeImage(this.src)">
                <img id="thumb-2" src="" alt="View 2" class="thumb" onclick="changeImage(this.src)">
                <img id="thumb-3" src="" alt="View 3" class="thumb" onclick="changeImage(this.src)">
                <img id="thumb-4" src="" alt="View 4" class="thumb" onclick="changeImage(this.src)">
            </div>
        </div>

        <div class="product-info">
            <div class="product-header-group">
                <h2 id="car-sub">PREMIUM COLLECTION</h2>
                <h1 id="car-name">Loading...</h1>
                <p id="car-price" class="price">Please wait...</p>
            </div>

            <p id="car-desc" class="description">
                Fetching vehicle details...
            </p>

            <div class="specs-grid" id="specs-container">
                <!-- Specs injected via JS -->
            </div>

            <div class="booking-form-container">
                <h3>Reserve This Vehicle</h3>
                <form class="booking-form" id="bookingForm">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" placeholder="Your Name">
                    </div>
                    <div class="form-group">
                        <label>Contact</label>
                        <input type="email" placeholder="Email or Phone">
                    </div>
                    <button type="submit" class="btn-primary full-width">Submit Inquiry</button>
                    <p class="form-note">*Non-binding reservation request</p>
                </form>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="car-reviews" style="padding: 4rem 20px; max-width: 1200px; margin: 0 auto;">
        <h2
            style="font-family: 'Orbitron'; margin-bottom: 2rem; border-bottom: 1px solid var(--glass-border); padding-bottom: 1rem;">
            Customer Reviews</h2>

        <div id="reviews-list" style="margin-bottom: 3rem; display: grid; gap: 1.5rem;">
            <p style="color: var(--text-secondary);">Loading reviews...</p>
        </div>

        <div class="review-form-container"
            style="background: rgba(255,255,255,0.02); padding: 2rem; border-radius: 12px; border: 1px solid var(--glass-border);">
            <h3 style="font-family: 'Orbitron'; margin-bottom: 1.5rem;">Leave a Review</h3>
            <form id="reviewForm">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Your
                        Name</label>
                    <input type="text" id="reviewAuthor" required
                        style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); border-radius: 6px; color: #fff;">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Rating
                        (1-5)</label>
                    <select id="reviewRating" required
                        style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); border-radius: 6px; color: #fff;">
                        <option value="5">5 - Excellent</option>
                        <option value="4">4 - Very Good</option>
                        <option value="3">3 - Average</option>
                        <option value="2">2 - Poor</option>
                        <option value="1">1 - Terrible</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Your
                        Review</label>
                    <textarea id="reviewText" required rows="4"
                        style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border); border-radius: 6px; color: #fff;"></textarea>
                </div>
                <button type="submit" class="btn-primary">Submit Review</button>
            </form>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="brand">
                <h2>BBT</h2>
                <p>Redefining the luxury car buying experience.</p>
            </div>
            <div class="socials">
                <a href="#">Instagram</a>
                <a href="#">Twitter</a>
                <a href="#">LinkedIn</a>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2026 Big Boy Toys. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        lucide.createIcons();
    </script>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const carId = urlParams.get('id') || 'bugatti-chiron'; // Default fallback matching script.js

            fetchReviews(carId);

            document.getElementById('reviewForm').addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = {
                    carId: carId,
                    author: document.getElementById('reviewAuthor').value,
                    rating: document.getElementById('reviewRating').value,
                    text: document.getElementById('reviewText').value
                };

                try {
                    const response = await fetch('/api/reviews', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();
                    if (data.success) {
                        alert(data.message);
                        document.getElementById('reviewForm').reset();
                        fetchReviews(carId); // refresh reviews list
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (err) {
                    console.error('Error submitting review:', err);
                    alert('Failed to submit review.');
                }
            });
        });

        async function fetchReviews(carId) {
            const list = document.getElementById('reviews-list');
            try {
                const response = await fetch(`/api/reviews/${carId}`);
                const data = await response.json();

                if (data.success) {
                    list.innerHTML = '';
                    if (data.reviews.length === 0) {
                        list.innerHTML = '<p style="color: var(--text-secondary);">No reviews yet. Be the first!</p>';
                        return;
                    }

                    // Reverse to show newest first
                    [...data.reviews].reverse().forEach(review => {
                        const stars = '★'.repeat(review.rating) + '☆'.repeat(5 - review.rating);
                        const dateStr = new Date(review.date).toLocaleDateString();

                        const item = document.createElement('div');
                        item.style.cssText = 'background: rgba(255,255,255,0.03); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--glass-border);';

                        const avatarHtml = review.avatar ? `<img src="${review.avatar}" alt="${review.author}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px; border: 2px solid var(--accent-primary);">` : `<div style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent-primary); display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 12px; font-family: 'Orbitron'; flex-shrink: 0;">${review.author.charAt(0)}</div>`;

                        item.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center;">
                                    ${avatarHtml}
                                    <div>
                                        <strong style="font-family: 'Orbitron'; display: block;">${review.author}</strong>
                                        <small style="color: var(--text-secondary);">${dateStr}</small>
                                    </div>
                                </div>
                                <span style="color: var(--accent-primary);">${stars}</span>
                            </div>
                            <p style="color: var(--text-primary); margin-top: 1rem; line-height: 1.5;">${review.text}</p>
                        `;
                        list.appendChild(item);
                    });
                }
            } catch (err) {
                console.error('Error fetching reviews:', err);
                list.innerHTML = '<p style="color: #ff4444;">Failed to load reviews.</p>';
            }
        }
    </script>
</body>

</html>